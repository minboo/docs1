(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{340:function(s,a,t){"use strict";t.r(a);var e=t(8),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"dnsmasq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dnsmasq"}},[s._v("#")]),s._v(" Dnsmasq")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("一开始选择了 "),a("a",{attrs:{href:"https://www.isc.org/bind/",target:"_blank",rel:"noopener noreferrer"}},[s._v("bind"),a("OutboundLink")],1),s._v("，试用后觉得配置麻烦就选择了更为轻量的 "),a("a",{attrs:{href:"http://www.thekelleys.org.uk/dnsmasq/doc.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("dnsmasq"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("该笔记基本参考 "),a("a",{attrs:{href:"https://www.cnblogs.com/pyyu/p/10318334.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CentOS7 安装 dnsmaqs 局域网 DNS"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("h3",{attrs:{id:"_1-基本环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基本环境"}},[s._v("#")]),s._v(" 1. 基本环境")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bind-utils dnsmasq "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-备份"}},[s._v("#")]),s._v(" 2. 备份")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/dnsmasq.conf /etc/dnsmasq.conf.bak\n")])])]),a("h3",{attrs:{id:"_3-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[s._v("#")]),s._v(" 3. 配置")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/etc/dnsmasq.conf")]),s._v(" 中可以看到都是注释项，所以猜测清空所有再增加也可：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示严格按照 resolv-file 文件中的顺序从上到下进行 DNS 解析, 直到第一个成功解析成功为止")]),s._v("\nstrict-order\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定上游dns服务器")]),s._v("\nresolv-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/resolv.dnsmasq.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义的dns记录文件")]),s._v("\naddn-hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/dnsmasq.hosts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设为当前服务器")]),s._v("\nlisten-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存大小")]),s._v("\ncache-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意该项是否正确（我在启用时网卡指向了另外一个）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("interface")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n")])])]),a("p",[s._v("填写上游 DNS 服务：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.dnsmasq.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入")]),s._v("\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.5")]),s._v(".5.5\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.6")]),s._v(".6.6\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\n")])])]),a("p",[s._v("填写自建的 DNS 解析：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/dnsmasq.hosts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.144 test.com\n")])])]),a("p",[s._v("将当前主机的 DNS 服务指向 "),a("code",[s._v("dnsmasq")]),s._v("，若重启失效那么需要对 "),a("code",[s._v("NetworkManager")]),s._v(" 进行配置。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.conf\n\nnameserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42\n")])])]),a("p",[s._v("最后重启服务：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置正确")]),s._v("\ndnsmasq "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\nsystemctl restart dnsmasq\n")])])]),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("p",[s._v("切换到其他主机下：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" @192.168.0.42 test.com\n")])])]),a("p",[s._v("如果测试失败，可以考虑端口是否被防火墙拦截：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("telnet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{294:function(a,s,t){"use strict";t.r(s);var e=t(8),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"人生苦短-我用-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#人生苦短-我用-docker"}},[a._v("#")]),a._v(" 人生苦短，我用 Docker")]),a._v(" "),s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[a._v("#")]),a._v(" 介绍")]),a._v(" "),s("p",[a._v("Docker 利用了 Linux 内核特性命名空间（namespace）及控制组（cgroups）等为容器提供隔离的运行环境，在此基础上可以认为 “容器是一种特殊的进程”。")]),a._v(" "),s("h2",{attrs:{id:"使用脚本快速启用-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用脚本快速启用-docker"}},[a._v("#")]),a._v(" 使用脚本快速启用 Docker")]),a._v(" "),s("p",[a._v("在过去常常"),s("a",{attrs:{href:"https://docs.docker.com/engine/install/",target:"_blank",rel:"noopener noreferrer"}},[a._v("手动安装"),s("OutboundLink")],1),a._v("，现在已经完全切换为脚本形式了：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-fsSL")]),a._v(" https://get.docker.com "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" get-docker.sh\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" get-docker.sh\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换源")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# sudo sh get-docker.sh --mirror Aliyun")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# sudo sh get-docker.sh --mirror AzureChinaCloud")]),a._v("\n")])])]),s("p",[a._v("如果担心脚本异常，可以下载并进行审核。")]),a._v(" "),s("p",[a._v("接着就可以开始愉快的使用了，例行习惯 Hello World：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run hello-world\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出")]),a._v("\nHello from Docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(". The Docker client contacted the Docker daemon.\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(". The Docker daemon pulled the "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hello-world"')]),a._v(" image from the Docker Hub.\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("amd64"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(". The Docker daemon created a new container from that image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" runs the\n    executable that produces the output you are currently reading.\n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(". The Docker daemon streamed that output to the Docker client, "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" sent it\n    to your terminal.\n\nTo try something "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" ambitious, you can run an Ubuntu container with:\n $ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" ubuntu "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n\nShare images, automate workflows, and "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" with a "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" Docker ID:\n https://hub.docker.com/\n\nFor "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" examples and ideas, visit:\n https://docs.docker.com/get-started/\n")])])]),s("h2",{attrs:{id:"初始化-docker-环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化-docker-环境"}},[a._v("#")]),a._v(" 初始化 Docker 环境")]),a._v(" "),s("h3",{attrs:{id:"设置用户组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置用户组"}},[a._v("#")]),a._v(" 设置用户组")]),a._v(" "),s("p",[a._v("为了避免每次使用 Docker 都需要切换到 "),s("code",[a._v("sudo")]),a._v("，可以将 "),s("code",[a._v("docker")]),a._v(" 加入当前用户。重新登录后生效。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$USER")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# or")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-aG")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" USER_NAME\n")])])]),s("h3",{attrs:{id:"镜像加速"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像加速"}},[a._v("#")]),a._v(" 镜像加速")]),a._v(" "),s("p",[a._v("镜像服务可用：")]),a._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors",target:"_blank",rel:"noopener noreferrer"}},[a._v("阿里云镜像服务"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.163yun.com/help/documents/56918246390157312",target:"_blank",rel:"noopener noreferrer"}},[a._v("网易云镜像服务"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("修改本地的 "),s("code",[a._v("/etc/docker/daemon.json")]),a._v(" 并修改 "),s("code",[a._v("registry-mirrors")]),a._v("，可为其配置多个避免某个挂掉：")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://hub-mirror.c.163.com"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h3",{attrs:{id:"修改存储路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改存储路径"}},[a._v("#")]),a._v(" 修改存储路径")]),a._v(" "),s("p",[a._v("通过 "),s("code",[a._v("docker info")]),a._v(" 可以看到默认路径为 "),s("code",[a._v("/var/lib/docker")]),a._v("，而一般服务器会额外挂载硬盘。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/docker/daemon.json\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 增加")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"data-root"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/path/to/docker"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启 docker")]),a._v("\nsystemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),s("p",[a._v("执行 "),s("code",[a._v("docker info")]),a._v(" 进行校验。")]),a._v(" "),s("h2",{attrs:{id:"热门镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#热门镜像"}},[a._v("#")]),a._v(" 热门镜像")]),a._v(" "),s("h3",{attrs:{id:"busybox"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#busybox"}},[a._v("#")]),a._v(" Busybox")]),a._v(" "),s("p",[a._v("以前常常会用 ubuntu 来测试一些命令行工具，现在有了更好的选择：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# --rm 用完即删")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" busybox\n")])])]),s("h3",{attrs:{id:"node-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-js"}},[a._v("#")]),a._v(" Node.js")]),a._v(" "),s("p",[a._v("从这里基本就可以了解到这些镜像只是在 Docker Engine 上增加了一些依赖，然后你又基于这些依赖搭建你的环境，可以看看 "),s("a",{attrs:{href:"https://hub.docker.com/layers/node/library/node/erbium-buster-slim/images/sha256-c6ad96c5345c1a714e0052d08d83635c8e422ea0d103adc7f9f2df4fcfb7fe2d?context=explore",target:"_blank",rel:"noopener noreferrer"}},[a._v("Node Images Layers"),s("OutboundLink")],1),a._v(" 加深该概念。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 追加 bash，否则会直接进入 node")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" node:slim "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])]),s("h3",{attrs:{id:"nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[a._v("#")]),a._v(" Nginx")]),a._v(" "),s("p",[a._v("快速测试本地打包好的静态文件。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /dir/dist/:/usr/share/nginx/html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  nginx\n")])])]),s("h3",{attrs:{id:"mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[a._v("#")]),a._v(" MySQL")]),a._v(" "),s("p",[a._v("指定密码。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("33006")]),a._v(":3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mypasswd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  mysql\n")])])]),s("h3",{attrs:{id:"mongo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongo"}},[a._v("#")]),a._v(" Mongo")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v(":27017 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" some-mongo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  mongo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--auth")]),a._v("\n")])])]),s("h3",{attrs:{id:"redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[a._v("#")]),a._v(" Redis")]),a._v(" "),s("p",[a._v("指定密码。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v(":6379 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" some-redis "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  redis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--requirepass")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"redispwd"')]),a._v("\n")])])]),s("h2",{attrs:{id:"移除-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#移除-docker"}},[a._v("#")]),a._v(" 移除 Docker")]),a._v(" "),s("p",[a._v("如果在之前修改了存储路径，则根据当前情况进行修改。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Ubuntu")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" purge docker-ce docker-ce-cli containerd.io\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# CentOS")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum remove docker-ce docker-ce-cli containerd.io\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还有 images、containers、volumes、and configurations")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker\n")])])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://docs.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/docker/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker Commands"),s("OutboundLink")],1)]),a._v(" "),s("li",[a._v("《Docker 技术入门与实战（第三版）》")]),a._v(" "),s("li",[a._v("《自己动手写 Docker》")])])])}),[],!1,null,null,null);s.default=r.exports}}]);
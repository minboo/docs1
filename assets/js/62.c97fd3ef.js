(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{342:function(a,s,t){"use strict";t.r(s);var e=t(8),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"fail2ban"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail2ban"}},[a._v("#")]),a._v(" fail2ban")]),a._v(" "),s("p",[a._v("服务器安全一直是一个问题，常使用 "),s("a",{attrs:{href:"https://github.com/fail2ban/fail2ban",target:"_blank",rel:"noopener noreferrer"}},[a._v("fail2ban"),s("OutboundLink")],1),a._v(" 来防止 SSH 暴力破解。")]),a._v(" "),s("p",[a._v("在启用 Web 服务后，常常会有一些脚本前来扫描是否存在漏洞，可以利用 "),s("code",[a._v("fail2ban")]),a._v(" 禁用访问的 IP。还可以后端放出一些陷阱数据，正常用户界面不会展示，而一旦有爬虫访问了该数据，则禁用对应的 IP。")]),a._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" fail2ban\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看日志")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /var/log/fail2ban.log\n")])])]),s("p",[a._v("在 "),s("code",[a._v("/etc/fail2ban/jail.conf")]),a._v(" 明确指出不应该修改该文件，应当使用 "),s("code",[a._v("jail.local")]),a._v(" 或 "),s("code",[a._v("jail.d/customisation.local")]),a._v("，个人更倾向于分模块处理。")]),a._v(" "),s("h3",{attrs:{id:"_1-ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ssh"}},[a._v("#")]),a._v(" 1. SSH")]),a._v(" "),s("p",[a._v("添加对 SSH 的限制：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/fail2ban/jail.d/sshd.local "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"EOF"\n[sshd]\nenabled = true\nport = ssh\nfilter = sshd\n# 禁用时长\nbantime = 120\n# 允许失败次数\nmaxretry = 3\n# 查找失败次数的时长\nfindtime = 600\naction = iptables[name=SSH, port=ssh, protocol=tcp]\nEOF')]),a._v("\n")])])]),s("p",[a._v("查看该限制的情况：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有 jail")]),a._v("\nfail2ban-client status\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看指定 jail")]),a._v("\nfail2ban-client status sshd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出")]),a._v("\nStatus "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" the jail: sshd\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Filter\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Currently failed: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Total failed:     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("- Journal matches:  "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("_SYSTEMD_UNIT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sshd.service + "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("_COMM")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sshd\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("- Actions\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Currently banned: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Total banned:     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n   `- Banned IP list:\n")])])]),s("p",[a._v("用错误的密码尝试四次：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("fail2ban-client status sshd\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出")]),a._v("\nStatus "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" the jail: sshd\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Filter\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Currently failed: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Total failed:     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("- Journal matches:  "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("_SYSTEMD_UNIT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sshd.service + "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("_COMM")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sshd\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("- Actions\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Currently banned: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("- Total banned:     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n   `- Banned IP list: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.1\n")])])]),s("p",[a._v("再以正确的密码访问也会被拒绝，可以等待禁用时长过去，也可以手动放行：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("fail2ban-client "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" sshd unbanip "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.0")]),a._v(".0.1\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);